<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../bower_components/px-card/px-card.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../bower_components/marked-element/marked-element.html">
<link rel="import" href="../../../bower_components/px-data-table/px-data-table.html"/>
<link rel="import" href="../../../bower_components/iron-pages/iron-pages.html"/>
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html"/>
<link rel="import" href="todolist-view-styles.html"/>

<dom-module id="todolist-view">
  <template>
    <style include="todolist-view-styles"></style>
      <px-data-table id="mytodotable" table-data={{mytabledata}}
                     language="en"
                     sortable
                     selectable
                     single-select>
      </px-data-table>

      <px-card>
        <button id="myTodoNewButton"  on-click="newTodo" class="btn btn--primary">New</button>
        <button id="myTodoUpdateButton" on-click="updateTodo" class="btn btn--primary">Update</button>
      </px-card>

    <!--<div id="myquote">-->
      <!--<span>Title: {{res.title}}</span>-->
      <!--<br>-->
      <!--<span>Content: {{res.content}}</span>-->
    <!--</div>-->

    <!--<div id="myrepos">-->
      <!--<template is="dom-repeat" items="{{repositories}}">-->
        <!--<span>-->
          <!--Name: <a href="{{item.html_url}}">{{item.name}}</a>-->
        <!--</span>-->
        <!--<br>-->
      <!--</template>-->
    <!--</div>-->


    <iron-ajax
      auto
      url="http://localhost:9000/api/randomquotes"
      handle-as = "json"
      last-response = "{{res}}">
    </iron-ajax>
    <iron-ajax
            auto
            url="https://api.github.com/users/devenc234/repos"
            handle-as = "json"
            last-response = "{{repositories}}">
    </iron-ajax>

  </template>
  <script>
    Polymer({
      is: 'todolist-view',
      properties: {
          page:{
            type: String,
              notify: true
          },
          mytabledata:{
              type: Array,
              // notify: true
          },
          clickedrowindex: {
              type: Number,
              // notify: true,
              observer: 'rowchanged'
          },
          todo: {
              type: Object,
              notify: true
          },
          res: {
              type: Object
          },
          repositories: {
              type: Object
          }
      },

      rowchanged: function(){
        console.log("rowchanged",this.clickedrowindex);
      },


      ready: function() {
        var updateButton = this.$.myTodoUpdateButton;
        var newButton = this.$.myTodoNewButton;
        updateButton.classList.add("btn--disabled");

        this.$.mytodotable.addEventListener("px-row-click", function(e) {
            var temp = {};
            temp.title = e.detail.row.row.title.value;
            temp.content = e.detail.row.row.content.value;
            this.clickedrowindex = e.detail.row.row.dataIndex;
            // this.set('clickedrowindex',e.detail.row.row.dataIndex);
            console.log('row clicked',this.clickedrowindex);
            if(e.detail.row._selected){
                newButton.classList.add("btn--disabled");
                updateButton.classList.remove("btn--disabled");
            } else {
                updateButton.classList.add("btn--disabled");
                newButton.classList.remove("btn--disabled");
            }
            console.log("resp",this.repositories);
        }.bind(this));
      }
      ,newTodo: function (e) {
          this.page = "create";
      }

      ,updateTodo: function (e) {
          this.page = "update";
          this.todo = this.mytabledata[this.clickedrowindex];
      }

    });
  </script>
</dom-module>
